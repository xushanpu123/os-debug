// autogenerated by syzkaller (https://github.com/google/syzkaller)

#define _GNU_SOURCE 

#include <endian.h>
#include <sched.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <unistd.h>

#include <linux/sched.h>

#ifndef __NR_clone3
#define __NR_clone3 435
#endif

#define USLEEP_FORKED_CHILD (3 * 50 *1000)

static long handle_clone_ret(long ret)
{
	if (ret != 0) {
		return ret;
	}
	usleep(USLEEP_FORKED_CHILD);
	syscall(__NR_exit, 0);
	while (1) {
	}
}

static long syz_clone(volatile long flags, volatile long stack, volatile long stack_len,
		      volatile long ptid, volatile long ctid, volatile long tls)
{
	long sp = (stack + stack_len) & ~15;
	long ret = (long)syscall(__NR_clone, flags & ~CLONE_VM, sp, ptid, ctid, tls);
	return handle_clone_ret(ret);
}

#define MAX_CLONE_ARGS_BYTES 256
static long syz_clone3(volatile long a0, volatile long a1)
{
	unsigned long copy_size = a1;
	if (copy_size < sizeof(uint64_t) || copy_size > MAX_CLONE_ARGS_BYTES)
		return -1;
	char clone_args[MAX_CLONE_ARGS_BYTES];
	memcpy(&clone_args, (void*)a0, copy_size);
	uint64_t* flags = (uint64_t*)&clone_args;
	*flags &= ~CLONE_VM;
	return handle_clone_ret((long)syscall(__NR_clone3, &clone_args, copy_size));
}

int main(void)
{
		syscall(__NR_mmap, 0x1ffff000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
	syscall(__NR_mmap, 0x20000000ul, 0x1000000ul, 7ul, 0x32ul, -1, 0ul);
	syscall(__NR_mmap, 0x21000000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);

memcpy((void*)0x20000140, "\x63\x61\x22\x4a\xfd\xfd\x06\xda\x2a\x3c\x88\xe4\x7d\x39\x72\xc4\xd8\x0d\xc2\x46\x95\xe4\x0c\x13\xf4\xf1\xb4\x79\x41\x38\x22\x99\xab\xf5\x95\x01\x61\xd9\xad\xcd\xf0\xbb\x6e\x08\x2b\x2c\xaa\x40\x02\xf0\xca\x5c\x82\x51\xb1\x8c\x5d\x87\x4b\x9e\xed\x55\xa5\x4c\x6a\x37\x30\x4f\x8d\xf9\x01\x2e\xbf\x2e\x80\x40\x84\x5d\x66\x7c\x55\xe7\xee\xf3\xa5\xcd\x5a\x6e\x22\x70\x41\x37\x32\x35\xe5\x8f\xe6\x56\x03\xb6\x88\x0b\x51\x40\x93\xfe\x2e\x2c\x79\x6d\xf5\x71\x9f\x16\xf0\x72\x16\x87\x83\x13\x66\xea\xf7\xd3\x43\x38\x7b\x44\xb8\xbc\xcc\x5a\x39\x7a\x34\x41\x6f\xba\x30\x2f\x52\x80\x48\xb2\xb0", 145);
syz_clone(0, 0, 0, 0, 0x20000100, 0x20000140);
	syscall(__NR_gettid);
*(uint64_t*)0x200017c0 = 0;
*(uint32_t*)0x200017c8 = 0;
*(uint64_t*)0x200017d0 = 0x20001780;
*(uint64_t*)0x20001780 = 0;
*(uint64_t*)0x20001788 = 0;
*(uint64_t*)0x200017d8 = 1;
*(uint64_t*)0x200017e0 = 0;
*(uint64_t*)0x200017e8 = 0;
*(uint32_t*)0x200017f0 = 0x408d4;
	syscall(__NR_sendmsg, -1, 0x200017c0ul, 4ul);
*(uint64_t*)0x20001680 = 0x40023000;
*(uint64_t*)0x20001688 = 0x200003c0;
*(uint64_t*)0x20001690 = 0x20001440;
*(uint64_t*)0x20001698 = 0x20001480;
*(uint32_t*)0x200016a0 = 0x35;
*(uint64_t*)0x200016a8 = 0x200014c0;
*(uint64_t*)0x200016b0 = 0xff;
*(uint64_t*)0x200016b8 = 0x200015c0;
*(uint64_t*)0x200016c0 = 0;
*(uint64_t*)0x200016c8 = 0;
*(uint32_t*)0x200016d0 = -1;
syz_clone3(0x20001680, 0x58);
memcpy((void*)0x20000240, "net_prio.ifpriomap\000", 19);
	syscall(__NR_openat, -1, 0x20000240ul, 2ul, 0ul);
	return 0;
}
