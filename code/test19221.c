// autogenerated by syzkaller (https://github.com/google/syzkaller)

#define _GNU_SOURCE 

#include <endian.h>
#include <fcntl.h>
#include <sched.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/stat.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <unistd.h>

#include <linux/sched.h>

#ifndef __NR_clone3
#define __NR_clone3 435
#endif

static long syz_open_dev(volatile long a0, volatile long a1, volatile long a2)
{
	if (a0 == 0xc || a0 == 0xb) {
		char buf[128];
		sprintf(buf, "/dev/%s/%d:%d", a0 == 0xc ? "char" : "block", (uint8_t)a1, (uint8_t)a2);
		return open(buf, O_RDWR, 0);
	} else {
		char buf[1024];
		char* hash;
		strncpy(buf, (char*)a0, sizeof(buf) - 1);
		buf[sizeof(buf) - 1] = 0;
		while ((hash = strchr(buf, '#'))) {
			*hash = '0' + (char)(a1 % 10);
			a1 /= 10;
		}
		return open(buf, a2, 0);
	}
}

#define USLEEP_FORKED_CHILD (3 * 50 *1000)

static long handle_clone_ret(long ret)
{
	if (ret != 0) {
		return ret;
	}
	usleep(USLEEP_FORKED_CHILD);
	syscall(__NR_exit, 0);
	while (1) {
	}
}

static long syz_clone(volatile long flags, volatile long stack, volatile long stack_len,
		      volatile long ptid, volatile long ctid, volatile long tls)
{
	long sp = (stack + stack_len) & ~15;
	long ret = (long)syscall(__NR_clone, flags & ~CLONE_VM, sp, ptid, ctid, tls);
	return handle_clone_ret(ret);
}

#define MAX_CLONE_ARGS_BYTES 256
static long syz_clone3(volatile long a0, volatile long a1)
{
	unsigned long copy_size = a1;
	if (copy_size < sizeof(uint64_t) || copy_size > MAX_CLONE_ARGS_BYTES)
		return -1;
	char clone_args[MAX_CLONE_ARGS_BYTES];
	memcpy(&clone_args, (void*)a0, copy_size);
	uint64_t* flags = (uint64_t*)&clone_args;
	*flags &= ~CLONE_VM;
	return handle_clone_ret((long)syscall(__NR_clone3, &clone_args, copy_size));
}

uint64_t r[3] = {0x0, 0x0, 0xffffffffffffffff};

int main(void)
{
		syscall(__NR_mmap, 0x1ffff000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
	syscall(__NR_mmap, 0x20000000ul, 0x1000000ul, 7ul, 0x32ul, -1, 0ul);
	syscall(__NR_mmap, 0x21000000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
				intptr_t res = 0;
*(uint64_t*)0x20000200 = 0;
*(uint64_t*)0x20000208 = 0;
*(uint64_t*)0x20000210 = 0;
*(uint64_t*)0x20000218 = 0;
*(uint32_t*)0x20000220 = 0;
*(uint64_t*)0x20000228 = 0;
*(uint64_t*)0x20000230 = 0;
*(uint64_t*)0x20000238 = 0;
*(uint64_t*)0x20000240 = 0;
*(uint64_t*)0x20000248 = 0;
*(uint32_t*)0x20000250 = -1;
	res = -1;
res = syz_clone3(0x20000200, 0x58);
	if (res != -1)
		r[0] = res;
*(uint64_t*)0x20000700 = 0;
*(uint64_t*)0x20000708 = 0x20000480;
*(uint64_t*)0x20000710 = 0;
*(uint64_t*)0x20000718 = 0x20000500;
*(uint32_t*)0x20000720 = 0x22;
*(uint64_t*)0x20000728 = 0x200000c0;
*(uint64_t*)0x20000730 = 0xa2;
*(uint64_t*)0x20000738 = 0x20000600;
*(uint64_t*)0x20000740 = 0x200006c0;
*(uint32_t*)0x200006c0 = 0;
*(uint32_t*)0x200006c4 = r[0];
*(uint32_t*)0x200006c8 = r[0];
*(uint32_t*)0x200006cc = 0;
*(uint64_t*)0x20000748 = 4;
*(uint32_t*)0x20000750 = -1;
syz_clone3(0x20000700, 0x58);
memcpy((void*)0x20000b40, "\x70\xc2\x02\x0d\x03\x6a\xc7\xab\x7b\xd7\xe7\x4a\x7c\x7d\x6b\x9a\x16\xcd\x9b\x77\xa8\x6a\xb1\xa0\x83\xd5\x77\x08\xab\x46\xc9\x69\xb7\xfd\x9d\x4e\x26\x54\x55\xb9\x64\x6d\xfd\x16\xd3\x81\xbe\x50\x47\x89\x16\xa1\x46\x0c\x8d\x8d\x51\xd5\x3b\xf0\x5b\xee\x85\x51\x89\x04\x68\x74\x7d\x97\xc1\x7a\xd0\x62\xee\x57\x04\x49\x58\xfb\x48\xbe\xb4\x88\x49\x89\x39\x7b\x9d\xef\xd6\x62\x03\xdc\x86\x4e\xb0\x7b\xf4\xc4\x19\x4f\x17\x12\xab\xf8\xc9\xb5\xba\x84\x6d\xe8\xdb\x53\xbc\xe0\xd8\x87\x83\xb0\x87\xca\xcd\xd0\xea\xad\xc7\xd4\xc5\x99\x9a\x9c\xa2\xd7\xee\x6d\xc8\x22\xc2\xbe\x8d\x9a\xbc\xc8\x79\xc8\x8d\x79\xfa\xe0\x53\x09\x9e\xa9\x02\x8c\x12\x58\xf3\x3a\x05\xdf\xeb\xdc\x4b\xd0\xf8\x36\x38\x32\x7b\x54\x20\x1f\x7c\x7e\x58\xde\xcd\xee\x43\x9b\x9a\xcb\xae\xb0\x01\xf4\x1d\xfc\x5f\x91\x3f\x11\xb7\x35\x31\x2d\x49\x95\xe1\x0b\x25\xb9\x08\x27\x97\x33\x7c\x69\xf5\x68\x5d\x6c\x10\x6e\x30\x25\x31\x11\x2b\xef\x5e\xa8", 224);
memcpy((void*)0x20000c40, "\x1f\x76\x85\x1e\x22\xf8\x3f\x1e\x11\x99\xf9\xdc\x1f\x29\x86\x48\x44\xb0\xfc\x4e\x32\x1a\x61\x1c\x2c\x18\x95\xa3\x1c\xdf\x96\x9b\x55\x1d\xba\x18\x2e\xd3\x61\x7c\x54\x46\xb9\x6d\x42\x70\x5d\x7e\xd8\x62\x97\x42\x26\x43\x2c\x45\xdb\x12\xb3\x58\xca\xc8\x75\xea\x7c\xcc\xb7\x90\x3f\xb2\x83\x96\x7e\x14\x0e\x26\xb6\x63\xf7\xa7\xfe\x17\x81\x6b\x14\x40\x8f\x88\x2b\xb8\x01\x4e\xec\xa9\x3c\xfa\x7f\xa6\x70\x37\x26\xad\xdc\xef\x9b\x7f\xba\x6b\x3e\x59\x30\xfd\x24\x33\xab\x91\x3d\xe6\x2c\xaa\x04\xc6\xab\x3b\xdb\xf3\x43\x4b\x8e\x06\x00\x9d\xae\x4c\x1f\xdb\xc6\xb2\xdc\x77\x13\x6f\xdd\x49\xf3\xaa\x94\x3a\x40\xa9\x3f\x7b\xd2\xb1\xd6\xd1\x08\xa8\xa4\xae\x06\x19\x80\x84\xd7\xa9\x6c\x65\x4e\x9c\x1f\xec\x47\xaa\xbb\x7a\x88\xa2\x88\x95\xe9\xa7\x1f\xa2\xc0\x09\x6f\x10\x1b\xd1\x35\x0d\x2b\x2e\xd0\xd7\xcf\x92\xaf", 199);
syz_clone(0x80202000, 0x20000b40, 0xe0, 0x20000180, 0x200001c0, 0x20000c40);
	res = syscall(__NR_getpgrp, -1);
	if (res != -1)
		r[1] = res;
	syscall(__NR_ioctl, -1, 0x8982, 0x20000d80ul);
*(uint64_t*)0x20000000 = 0;
*(uint32_t*)0x20000008 = 0;
*(uint32_t*)0x2000000c = 1;
*(uint32_t*)0x20000010 = r[1];
	syscall(__NR_timer_create, 2ul, 0x20000000ul, 0x20000040ul);
*(uint64_t*)0x20000e40 = 0;
*(uint64_t*)0x20000e48 = 0;
*(uint64_t*)0x20000e50 = 0;
*(uint64_t*)0x20000e58 = 0x989680;
	syscall(__NR_timer_settime, 0, 1ul, 0x20000e40ul, 0x20000e80ul);
	syscall(__NR_getpgrp, -1);
syz_clone3(0, 0);
memcpy((void*)0x20000480, "/dev/vcsa#\000", 11);
	res = -1;
res = syz_open_dev(0x20000480, 1, 2);
	if (res != -1)
		r[2] = res;
memcpy((void*)0x20001140, "\x48\x00\x00\x00\x00\x00\x65\x76\xca\x04\xb8\xf4\x3b\x25\xab\x07\xbb\xba\xe3\x45\xf8\x8d\xc9\x2b\xd9\x2b\xcd\x7d\xa6\xf2\x19\x14\x22\x2d\x54\x06\xc1\x67\xa6\x39\xfa\x89\x20\x3f\x47\x0e\x62\x9d\x58\xb6\x88\xa5\x8e\xb2\x57\x9a\x15\xa6\x7f\x84\xab\xf7\x12\x25\xcb\xca\x65\xb5\x31\xe6\x6d\x9d\x91\x0d\x58\x59\x26\x7a\x65\xf8\x33\x3f\x38\x2d\x6e\x36\x2d\x15\xc7\x53\xb7\x10\x1e\x79\x61\xf0\x37\xed\x99\xad\x54\x49\xc3\x4a\xa8\x22\x97\x0e\x59\x92\x2b\x04\x5f\x1d\x0e\xe1\x78\x78\xe1\x0a\x47\x4c\x73\x23\x90\x26\x98\xec\x27\x64\xd0\x20\x9c\x7b\xcb\x76\x13\x59\xdd\x94\xe4\xb7\xb8\x95\xfd\xcf\x25\x55\x63\x25\x47\x3d\xcf\x1d\x4b\x21\x0d\xaa\xe3\x84\x8e\x5d\xbe\xee\xe2\xfb\xd1\x63\x57\x84\x1d\xcb\xde\xb0\x84\x89\x2a\x07\xb2\x61\xd0\xbb\x56\x70\x66\xb0\xe3\x68\x10\xf9\x76\x6a\x90\x58\x97\xcc\x00\xb3\x5b\xca\xdf\xdc\xab\xf1\x66\xf9\x17\x2f\xf0\x0e\xfb\xbb\x56\x49\xd7\x14\xb2\xf8\x16\xa9\x6c\x43\x8e\xe3\x3f\xd1\x58\xab\x0d\x64\xbc\xf1\x48\x81\xfd\x02\xf0\x69\x02\x91\x7b\xbd\x70\x5a\xc2\x81\xa3\xbf\x4f\x22\x97\x09\xc6\xd1\x7d\x84\x96\x70\xb9\x75\x80\x6a\x8f\xcb\xf4\xdf\x5e\xa4\x54\x2e\xd0\x15\xac\xbb\x47\x0b\x00\x76\xde\xb6\xef\x09\x79\x31\x4e\xec\xf9\xab\xb1\x77\x9d\x81\x9c\xa0\xd3\x79\x9f\xbd\x86\xe4\x20\x35\x02\x23\xbf\xbf\xd8\xb3\xad\x81\x6d\xcc\x9f\x0f\xa2\x5c\x1f\x5d\xa0\x0b\x0b\x20\x5e\xb8\xb6\xdf\x64\x33\x88\xd7\x8b\x65\x2a\x44\xb7\x00\x00\x00\x4c", 339);
	syscall(__NR_write, r[2], 0x20001140ul, 0x153ul);
	return 0;
}
