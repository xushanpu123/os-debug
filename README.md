# os-debug

2023.3.2

目前的进度还是在跑测例，昨天晚上让他每个qemu跑一个实例，先出个结果，然后统计一下下。

TODO：

1、先把绝对路径改成相对路径，将来迁移到服务器上面去。

2、等昨天晚上开的这些测例全都跑完，写个脚本把输出信息清理一下并进行一下统计，统计哪些测例能够正常运行，哪些测例报了错，以及报错的内容是什么。用于后续工作。

3、写脚本，让它开多个docker或者直接shell多线程。其实这不难，难点在于测例太多，需要让这些线程喂进去不同的测例，然后把这玩意儿放到服务器上面去跑。

2023.3.2日结束

已经改成相对路径了，开始迁移到服务器上面，但是环境有一些问题，比如说，服务器上面的python是3.8版本的，但是代码中，我们用了个3.9版本的函数，不知道为啥装不上，明天再说。还有那个仓库私有的，结果秘钥折腾了半天，扒拉不到服务器上面去，最后scp算了，大概就这样。（啊对，今天晚上朱懿终于能进bst的那块板子了，很开心。）

2023.3.5

前两天试图把东西扔到服务器上面去，但是遇到了一堆问题，我们也觉得挺奇怪，一个一个bug修复也非常痛苦，最后在装qemu的时候，发现，这个服务器上面跑的ubuntu是16.04LTS，emmm大概就是说，他有一个依赖包，需要的版本比这个ubuntu能安装的最新版本还要高，当然可以手动安装就是了。不过我真的不想再去修复这无穷无尽的坑了。

我昨天，由于我为了跑bst的板子，重新装了一个ubuntu22.04的版本，在该环境下配置，并没有太多的问题，所以，我对此的看法基本就是，那个服务器的os版本太过老旧，今天要不让任乐图去升级或者想想办法吧。

代码上面我进行了一些调整，更加便于从github上面直接抓包下来就能部署，直接在根文件夹下面跑那个run.sh即可的那种，输出放在libc/output里面，这会不再是全都输出到一个文件，而是分别处理，便于清洗数据。

当然，代价是，基本所有的东西都被扔进github了，这当然不符合一些规范，但是，我想这不是我们应该考虑的事情

对于其如何进行多进程的代码还在研究，因为确实任务的分发有些麻烦——尤其是考虑到后续测例数量的上升

但愿今天有更多的进度吧。

2023.3.5

现在这份代码已经可以多进程了，在测例的id上面有一些问题，需要查错，但是问题不大，主要是，他还有个文件锁，因此，虽然多进程达成，但是我个人感觉，效率仍然很糟糕。

因此，还是先打包docker吧

吃饭的时候仔细思考了一下，即使放到docker，他仍然只有一份文件实例，还是会产生竞争和锁，因此，直接暴力方法，开多个文件夹，调整一下参数吧，哈哈哈哈哈

2023.3.6

关于数据清洗

请把clean_data.py放到解压后的output文件夹

对于昨天跑的5000个测例，洗出来的结果也放在这个文件夹了，就是那个res.xlsx。这excel操作起来还是比较容易的吧。

还有跑docker的事情，我昨天环境配好，也认真思考过锁的问题，下面慢慢说

我的docker命令是这样的

docker run --name="os_debug0" -dit -p 10086:80 -v /home/lab/oslab-300G:/home ubuntu:22.04

当然如果启动多个docker，请务必更改os_debug后面的数字以及映射的网络端口号（额，10086的服务其实也还好啦）

如果运行在别的服务器上面，请查看-v的文件路径映射，进行相应的更改

然后进入容器：

先docker ps -la查看对应容器的container id，然后再使用

docker exec -it container_id /bin/bash

对于规避文件锁的情况，在映射的路径下面，复制n份对应的文件，同样开启n个docker，一一对应，在docker里面跑一个进程就好了。

我会把镜像配好并打包，新的包命名为os-dbg，使用docker images即可查看

上面run的命令里面最后的ubuntu改成这个。

2023.3.7

emmm,心情极度复杂，我给他弄了多个实例，也弄了多个容器，然后让不同容器运行在不同的实例上面

结果还是卡死了，而且是docker的并发问题。（我就说嘛，我当时就琢磨着，这不行有问题）

算了不管了，先去研究板子了，下午刷完机试题问问陈老师吧。。。这事情，看来只能多进程，竞争cargo的锁就竞争吧。


